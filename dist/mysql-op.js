!function(e,u){"object"==typeof exports&&"object"==typeof module?module.exports=u():"function"==typeof define&&define.amd?define([],u):"object"==typeof exports?exports.SqlUtil=u():e.SqlUtil=u()}(window,(function(){return function(e){var u={};function l(t){if(u[t])return u[t].exports;var r=u[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}return l.m=e,l.c=u,l.d=function(e,u,t){l.o(e,u)||Object.defineProperty(e,u,{enumerable:!0,get:t})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,u){if(1&u&&(e=l(e)),8&u)return e;if(4&u&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(l.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&u&&"string"!=typeof e)for(var r in e)l.d(t,r,function(u){return e[u]}.bind(null,r));return t},l.n=function(e){var u=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(u,"a",u),u},l.o=function(e,u){return Object.prototype.hasOwnProperty.call(e,u)},l.p="",l(l.s=0)}([function(e,u){e.exports=class{constructor(e,u){this.pool=e,this.table=u}insert(e){return new Promise((u,l)=>{var t="",r=[];for(var n in e)t+="?,",r.push(e[n]);t=t.substr(0,t.length-1);var a="insert into "+this.table+" values ("+t+")";this.pool.query(a,r,(e,t)=>{e?l(e):u(t)})})}update(e,u){return new Promise((l,t)=>{var r="",n=[],a=null;for(var o in e)o===u?a=o:(r+=o+"=?,",n.push(e[o]));r=r.substr(0,r.length-1),a&&(r+=" where "+a+"=?",n.push(e[a]));var s="update "+this.table+" set "+r;this.pool.query(s,n,(e,u)=>{e?t(e):l(u)})})}delete(e,u){return new Promise((l,t)=>{var r="delete from "+this.table+" where "+e+"=?",n=[u];this.pool.query(r,n,(e,u)=>{e?t(e):l(u)})})}query(e,u,l){return new Promise((t,r)=>{var n="";if(l instanceof Array&&l.length>0){for(var a=0;a<l.length;a++)n+=","+l[a];n=n.substr(1)}else n="*";var o=`select ${n} from ${this.table} where ${e}=?`,s=[u];this.pool.query(o,s,(e,u)=>{e?r(e):t(u)})})}querys(e,u,l,t,r,n,a){return new Promise((o,s)=>{var f="";if(a instanceof Array&&a.length>0){for(var i=0;i<a.length;i++)f+=","+a[i];f=f.substr(1)}else f="*";var v=`select ${f} from ${this.table}`,p=[];v+=" where ",Object.keys(e).forEach((function(l,t){var r={};"object"==typeof e[l]?(r.value=e[l].value,"boolean"==typeof e[l].fuzzy?r.fuzzy=e[l].fuzzy:r.fuzzy=!1,"boolean"==typeof e[l].equal?r.equal=e[l].equal:r.equal=!0):(r.value=e[l],r.fuzzy=!1,r.equal=!0),r.value instanceof Array?null!=r.value[0]&&null!=r.value[1]&&null!=r.value[0]&&null!=r.value[1]?(r.value[0]<=r.value[1]?r.equal?v+=`(${l}>=? and ${l}<=?) ${u} `:v+=`(${l}>? and ${l}<?) ${u} `:r.equal?v+=`(${l}>=? or ${l}<=?) ${u} `:v+=`(${l}>? or ${l}<?) ${u} `,p.push(r.value[0]),p.push(r.value[1])):null!=r.value[0]&&null!=r.value[0]?(r.equal?v+=`${l}>=? ${u} `:v+=`${l}>? ${u} `,p.push(r.value[0])):null!=r.value[1]&&null!=r.value[1]&&(r.equal?v+=`${l}<=? ${u} `:v+=`${l}<? ${u} `,p.push(r.value[1])):(r.fuzzy?v+=`locate(?,${l})>0 ${u} `:v+=`${l}=? ${u} `,p.push(r.value))}));const $=v.lastIndexOf(u);v=$>-1?v.substring(0,$):v.substring(0,v.lastIndexOf("where")),l&&t&&(v+=`order by ${l} ${t} `),"number"!=typeof r||"number"!=typeof n||isNaN(r)||isNaN(n)||(v+=" limit ?,? ",p.push(r),p.push(n)),this.pool.query(v,p,(e,u)=>{e?s(e):o(u)})})}queryCounts(e,u){return new Promise((l,t)=>{var r=`select count(1) from ${this.table}`,n=[];r+=" where ",Object.keys(e).forEach((function(l,t){var a={};"object"==typeof e[l]?(a.value=e[l].value,"boolean"==typeof e[l].fuzzy?a.fuzzy=e[l].fuzzy:a.fuzzy=!1,"boolean"==typeof e[l].equal?a.equal=e[l].equal:a.equal=!0):(a.value=e[l],a.fuzzy=!1,a.equal=!0),a.value instanceof Array?null!=a.value[0]&&null!=a.value[1]&&null!=a.value[0]&&null!=a.value[1]?(a.value[0]<=a.value[1]?a.equal?r+=`(${l}>=? and ${l}<=?) ${u} `:r+=`(${l}>? and ${l}<?) ${u} `:a.equal?r+=`(${l}>=? or ${l}<=?) ${u} `:r+=`(${l}>? or ${l}<?) ${u} `,n.push(a.value[0]),n.push(a.value[1])):null!=a.value[0]&&null!=a.value[0]?(a.equal?r+=`${l}>=? ${u} `:r+=`${l}>? ${u} `,n.push(a.value[0])):null!=a.value[1]&&null!=a.value[1]&&(a.equal?r+=`${l}<=? ${u} `:r+=`${l}<? ${u} `,n.push(a.value[1])):(a.fuzzy?r+=`locate(?,${l})>0 ${u} `:r+=`${l}=? ${u} `,n.push(a.value))}));const a=r.lastIndexOf(u);r=a>-1?r.substring(0,a):r.substring(0,r.lastIndexOf("where")),this.pool.query(r,n,(e,u)=>{e?t(e):l(u[0]["count(1)"])})})}}}])}));